<!DOCTYPE html>
<html
  th:lang="${#locale.toLanguageTag}"
  xmlns:th="http://www.thymeleaf.org"
  th:fragment="html (_templateId)"
  th:with="templateId=${_templateId != null ? _templateId : 'index'}"
>
  <th:block th:fragment="post-intro">
    <div
      class="site-intro"
      th:style="|height: ${theme.config.style.post_intro_height ?: 50}vh;|"
      th:with="
        coverImage=${#strings.isEmpty(post.spec.cover) ? null : post.spec.cover},
        headerImage=${#strings.isEmpty(theme.config.style.site_header_image) ? null : theme.config.style.site_header_image},
        defaultImage=@{/assets/intro/post-bg.jpg},
        backgroundImage=${coverImage != null ? coverImage : (headerImage != null ? headerImage : defaultImage)}"
    >
      <div class="site-intro-placeholder"></div>
      <div class="site-intro-img" th:style="|background-image: url(${backgroundImage});|"></div>
      <div class="site-intro-meta">
        <h1 class="intro-title intro-fade-in" th:text="${post.spec.title ?: '[Untitled Post]'}">Post Title</h1>
        <p
          class="intro-subtitle intro-fade-in"
          th:if="${not #strings.isEmpty(post.spec.excerpt?.raw)}"
          th:text="${post.spec.excerpt.raw}"
        >Post Subtitle</p>
        <div class="post-intros post-fade-in">
          <th:block th:replace="~{::post-tags-and-categories}" />
          <th:block th:replace="~{::post-reading-info}" />
          <th:block th:replace="~{::post-meta-and-share}" />
        </div>
      </div>
    </div>
  </th:block>

  <th:block th:fragment="post-tags-and-categories">
    <div
      class="post-intro-tags"
      th:if="${(not #lists.isEmpty(post.tags)) or (not #lists.isEmpty(post.categories))}"
    >
      <th:block th:if="${not #lists.isEmpty(post.categories)}">
        <a
          th:each="category : ${post.categories}"
          th:href="|/categories/${category.metadata.name}|"
          class="post-category"
          th:data-category="${category.metadata.name}"
        >
          <span class="iconfont-archer category-icon">&#xe606;</span>
          <span th:text="${category.spec.displayName}">Category</span>
        </a>
      </th:block>
      <th:block th:if="${not #lists.isEmpty(post.tags)}">
        <a
          th:each="tag : ${post.tags}"
          th:href="|/tags/${tag.metadata.name}|"
          class="post-tag"
          th:data-tag="${tag.metadata.name}"
        >
          <span class="iconfont-archer tag-icon"></span>
          <span th:text="${tag.spec.displayName}">Tag</span>
        </a>
      </th:block>
    </div>
  </th:block>

  <th:block th:fragment="post-reading-info">
    <div
      class="post-intro-read"
      th:if="${theme.config.style?.reading_info == true}"
      th:with="
        wordCount=${#strings.length(post.content.raw)},
        readingMinutes=${T(java.lang.Math).max(1.0, T(java.lang.Math).ceil(wordCount / 400.0))}"
    >
      <span>
        字数统计: <span class="post-count word-count" th:text="${wordCount}">0</span>
        阅读时长: <span class="post-count reading-time" th:text="|${readingMinutes} min|">1 min</span>
      </span>
    </div>
  </th:block>

  <th:block th:fragment="post-meta-and-share">
    <div class="post-intro-meta">
      <span class="iconfont-archer post-intro-calander"></span>
      <span class="post-intro-time" th:text="${#dates.format(post.spec.publishTime, 'yyyy/MM/dd')}">2024/01/01</span>
      <span
        id="busuanzi_container_page_pv"
        class="busuanzi-pv"
        th:if="${theme.config.analytics?.busuanzi?.enable == true}"
      >
        <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
        <span id="busuanzi_value_page_pv"></span>
      </span>
      <span class="share-wrapper">
        <span class="iconfont-archer share-icon">&#xe71d;</span>
        <span class="share-text">Share</span>
        <ul class="share-list">
          <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
            <div class="share-qrcode"></div>
          </li>
          <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
          <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
          <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
          <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
        </ul>
      </span>
    </div>
  </th:block>

  <th:block th:fragment="simple-intro (title, subtitle, icon)">
    <div
      class="site-intro"
      th:style="|height: ${theme.config.style.index_intro_height ?: 50}vh;|"
      th:with="
        headerImage=${#strings.isEmpty(theme.config.style.site_header_image) ? null : theme.config.style.site_header_image},
        defaultImage=@{/assets/intro/index-bg.jpg},
        backgroundImage=${headerImage != null ? headerImage : defaultImage}"
    >
      <div class="site-intro-placeholder"></div>
      <div class="site-intro-img" th:style="|background-image: url(${backgroundImage});|"></div>
      <div class="site-intro-meta">
        <h1 class="intro-title intro-fade-in">
          <span class="iconfont-archer" th:if="${icon != null and icon != ''}" th:utext="${icon}"></span>
          <span th:text="${title}">Title</span>
        </h1>
        <h2
          class="intro-subtitle intro-fade-in"
          th:if="${not #strings.isEmpty(subtitle)}"
          th:text="${subtitle}"
        >Subtitle</h2>
      </div>
    </div>
  </th:block>

  <th:block th:switch="${templateId}">
    <th:block th:case="'post'" th:replace="~{::post-intro}" />
    <th:block
      th:case="'index'"
      th:replace="~{::simple-intro(title=${theme.config.basic.main_title ?: site.title}, subtitle=${theme.config.basic.subtitle ?: ''}, icon=${null})}"
    />
    <th:block
      th:case="'tag'"
      th:replace="~{::simple-intro(title=${tag.spec.displayName}, subtitle=${'共 ' + posts.total + ' 篇文章'}, icon='&#xe61b;')}"
    />
    <th:block
      th:case="'category'"
      th:replace="~{::simple-intro(title=${category.spec.displayName}, subtitle=${'共 ' + posts.total + ' 篇文章'}, icon='&#xe666;')}"
    />
    <th:block
      th:case="'catagory'"
      th:replace="~{::simple-intro(title=${category.spec.displayName}, subtitle=${'共 ' + posts.total + ' 篇文章'}, icon='&#xe666;')}"
    />
  </th:block>
</html>
