<th:block th:fragment="background(templateId)">
  <th:block
    th:with="
      indexHeight=${theme.config.style.index_intro_height != null ? theme.config.style.index_intro_height : 50},
      postHeight=${theme.config.style.post_intro_height != null ? theme.config.style.post_intro_height : 50},
      aboutHeight=${theme.config.style.about_intro_height != null ? theme.config.style.about_intro_height : 50},
      heightValue=${templateId == 'post' ? postHeight : (templateId == 'about' ? aboutHeight : indexHeight)},
      siteHeader=${theme.config.style.site_header_image != null ? theme.config.style.site_header_image : '/assets/intro/index-bg.jpg'},
      postHeaderCandidate=${post != null && post.spec != null ? (post.spec.headImage != null ? post.spec.headImage : post.spec.cover) : null},
      postHeader=${postHeaderCandidate != null ? postHeaderCandidate : (theme.config.style.post_header_image != null ? theme.config.style.post_header_image : '/assets/intro/post-bg.jpg')},
      aboutHeaderCandidate=${singlePage != null && singlePage.spec != null ? singlePage.spec.cover : null},
      aboutHeader=${aboutHeaderCandidate != null ? aboutHeaderCandidate : (theme.config.style.about_header_image != null ? theme.config.style.about_header_image : '/assets/intro/about-bg.jpg')},
      errorHeader=${theme.config.style._404_header_image != null ? theme.config.style._404_header_image : '/assets/intro/404-bg.jpg'},
      bgPath=${templateId == 'post' ? (postHeader != null ? postHeader : siteHeader)
        : templateId == 'about' ? (aboutHeader != null ? aboutHeader : siteHeader)
        : templateId == '404' ? (errorHeader != null ? errorHeader : siteHeader)
        : siteHeader},
      resolvedBg=${bgPath != null ? bgPath : '/assets/intro/index-bg.jpg'}
    "
  >
    <div class="site-intro" th:style="|height: ${heightValue}vh;|">
      <div class="site-intro-placeholder"></div>
      <div class="site-intro-img" th:style="${'background-image: url(' + resolvedBg + ');'}"></div>
      <div class="site-intro-meta">
        <h1 class="intro-title"
          th:text="${templateId == 'index' ? (theme.config.basic.main_title != null ? theme.config.basic.main_title : site.title)
            : (templateId == 'post' ? (post != null && post.spec != null && !#strings.isEmpty(post.spec.title) ? #strings.abbreviate(post.spec.title, 80) : '[Untitled Post]')
            : (templateId == 'about' ? (singlePage != null && singlePage.spec != null && !#strings.isEmpty(singlePage.spec.title) ? singlePage.spec.title : 'About')
            : (templateId == 'page' ? (singlePage != null && singlePage.spec != null && !#strings.isEmpty(singlePage.spec.title) ? singlePage.spec.title : '[Untitled Page]')
            : (templateId == 'archives' ? 'Archives'
            : (templateId == 'categories' ? 'Categories'
            : (templateId == 'tags' ? 'Tags'
            : (templateId == '404' ? '404'
            : (theme.config.basic.main_title != null ? theme.config.basic.main_title : site.title))))))))}">
        </h1>
        <p class="intro-subtitle"
          th:utext="${templateId == 'index' ? (theme.config.basic.subtitle != null ? theme.config.basic.subtitle : site.subtitle)
            : (templateId == 'post' ? (post != null && post.status != null && !#strings.isEmpty(post.status.excerpt) ? post.status.excerpt : '')
            : ((templateId == 'about' or templateId == 'page') ? (singlePage != null && singlePage.status != null && !#strings.isEmpty(singlePage.status.excerpt) ? singlePage.status.excerpt : '')
            : (templateId == '404' ? (site.description != null ? site.description : 'Page not found') : ''))}">
        </p>
        <div class="post-intros" th:if="${templateId == 'post'}">
          <th:block th:if="${(theme.config.style.show_categories == true && post != null && not #lists.isEmpty(post.categories)) or (post != null && not #lists.isEmpty(post.tags))}">
            <th:block th:replace="~{modules/partials/base-title-tags :: base-title-tags(${post}, 'post-intro-tags')}" />
          </th:block>
          <div class="post-intro-read" th:if="${theme.config.style.reading_info == true && post != null && post.stats != null}">
            <span>
              <span>Word count: </span>
              <span class="post-count word-count" th:text="${post.stats.wordCount}"></span>
              <span>&nbsp;â€¢&nbsp;Reading time: </span>
              <span class="post-count reading-time" th:text="${post.stats.readingTime}"></span>
              <span> min</span>
            </span>
          </div>
          <div class="post-intro-meta">
            <span class="iconfont-archer post-intro-calander">&#xe676;</span>
            <span class="post-intro-time" th:text="${#dates.format(post.spec.publishTime, 'yyyy/MM/dd')}"></span>
            <span
              id="busuanzi_container_page_pv"
              class="busuanzi-pv"
              th:if="${theme.config.analytics.busuanzi.enable == true}"
            >
              <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="share-wrapper">
              <span class="iconfont-archer share-icon">&#xe71d;</span>
              <span class="share-text">Share</span>
              <ul class="share-list">
                <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                  <div class="share-qrcode"></div>
                </li>
                <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
              </ul>
            </span>
          </div>
        </div>
      </div>
    </div>
  </th:block>
</th:block>
