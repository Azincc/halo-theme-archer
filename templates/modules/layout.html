<!doctype html>
<html th:lang="${#locale.toLanguageTag}" xmlns:th="http://www.thymeleaf.org"
    th:fragment="html (content, page_js, _title, _templateId)"
    th:with="templateId=${_templateId != null ? _templateId : 'index'}">

<head th:replace="~{modules/head :: head(${_title}, ${templateId})}"></head>

<body
    th:with="bodyClass=${templateId == 'index' ? 'home-body' : templateId == 'post' ? 'post-body' : templateId == 'about' ? 'about-body' : templateId == '404' ? 'four-zero-four-body' : ''}"
    th:class="${bodyClass}" th:classappend="${#authentication.name != 'anonymousUser'} ? ' logged-in'">
    <th:block th:replace="~{modules/header :: header}"></th:block>

    <th:block th:replace="~{modules/footer-fixed :: footer-fixed(templateId=${templateId})}"></th:block>

    <div class="wrapper">
        <th:block th:replace="~{fragment/intro::html(${templateId})}" />

        <img class="loading" th:src="@{/assets/loading.svg}"
            style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem" alt="loading" />

        <div class="container container-unloaded">
            <th:block th:replace="${content}" />
        </div>

        <th:block th:replace="~{modules/footer :: footer}"></th:block>
    </div>

    <!-- TOC -->
    <th:block th:if="${templateId == 'post' and (theme.config.style.toc ?: true)}">
        <th:block th:replace="~{modules/toc :: toc}"></th:block>
    </th:block>

    <!-- Sidebar -->
    <th:block th:replace="~{modules/sidebar :: sidebar}"></th:block>

    <!-- Site metadata for sidebar JavaScript -->
    <th:block th:replace="~{modules/sidebar :: site-meta}"></th:block>

    <script th:src="@{/assets/dist/main.js}" type="module"></script>
    <script th:inline="javascript">
        (function () {
            var scheme = /*[[${theme.config.style.color_scheme}]]*/ 'system';
            window.__archerMainCallbacks = window.__archerMainCallbacks || [];
            window.__archerMainCallbacks.push(function (mainModule) {
                if (mainModule && typeof mainModule.initializeColorScheme === 'function') {
                    mainModule.initializeColorScheme(scheme);
                }
            });
            if (window.main && typeof window.main.initializeColorScheme === 'function') {
                window.main.initializeColorScheme(scheme);
            }
        })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js"
        onload="window.Fancybox && window.Fancybox.bind('[data-fancybox]')" defer></script>

    <th:block th:if="${theme.config.analytics?.busuanzi?.enable == true}">
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
    </th:block>

    <th:block th:if="${templateId == 'post'}">
        <script th:src="@{/assets/dist/share.js}" type="module"></script>
    </th:block>

    <th:block th:if="${templateId == 'post' and (theme.config.other.mermaid.enable?: false)}">
        <script
            th:src="|https://cdn.jsdelivr.net/npm/mermaid@${theme.config.other.mermaid.version}/dist/mermaid.min.js|"
            th:attr="onload=|window.mermaid && window.mermaid.initialize({theme: '${theme.config.other.mermaid.theme ?: 'default'}'})|"
            async></script>
    </th:block>

    <th:block th:if="${page_js != null}" th:replace="${page_js}" />




</body>

</html>