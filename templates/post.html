<th:block th:replace="~{modules/layout :: html(~{::content}, ~{::page_js}, ${post.spec.title}, 'post')}"
          xmlns:th="http://www.w3.org/1999/xhtml">
  <th:block th:fragment="content">
    <main class="main post-page">
      <!-- Post Intro - Header Image Area -->
      <div class="site-intro" th:style="|height: ${theme.config.style.post_intro_height ?: 50}vh;|">
        <div class="site-intro-placeholder"></div>
        <div
          class="site-intro-img"
          th:style="${post.spec.cover != null && post.spec.cover !=''} ?
          |background-image: url(${post.spec.cover});| :
           (${theme.config.style.site_header_image != null&&theme.config.style.site_header_image!='' } ?
           |background-image: url(${theme.config.style.site_header_image});|
           : |background-image: url(@{/assets/intro/post-bg.jpg});|)"
        >
        </div>
        <div class="site-intro-meta">
          <h1 class="intro-title intro-fade-in" th:text="${post.spec.title ?: '[Untitled Post]'}">
            Post Title
          </h1>
          <p class="intro-subtitle intro-fade-in" th:if="${not #strings.isEmpty(post.spec.excerpt?.raw)}"
             th:text="${post.spec.excerpt.raw}">
            Post Subtitle
          </p>
          <!-- Post Metadata -->
          <div class="post-intros post-fade-in">
            <!-- Tags and Categories -->
            <div class="post-intro-tags"
                 th:if="${(not #lists.isEmpty(post.tags)) or (not #lists.isEmpty(post.categories))}">
              <th:block th:if="${not #lists.isEmpty(post.categories)}">
                <a th:each="category, iterStat : ${post.categories}"
                   th:href="|/categories/${category.metadata.name}|"
                   class="post-category"
                   th:data-category="${category.metadata.name}">
                  <span class="iconfont-archer category-icon">&#xe606;</span>
                  <span th:text="${category.spec.displayName}">Category</span>
                </a>
              </th:block>
              <th:block th:if="${not #lists.isEmpty(post.tags)}">
                <a th:each="tag, iterStat : ${post.tags}"
                   th:href="|/tags/${tag.metadata.name}|"
                   class="post-tag"
                   th:data-tag="${tag.metadata.name}">
                  <span class="iconfont-archer tag-icon"></span>
                  <span th:text="${tag.spec.displayName}">Tag</span>
                </a>
              </th:block>
            </div>
            <!-- Reading Info -->
            <div
              class="post-intro-read"
              th:if="${theme.config.style?.reading_info == true}"
              th:with="wordCount = ${#strings.length(post.content.raw)},
                       readingMinutes=${T(java.lang.Math).max(1.0, T(java.lang.Math).ceil(wordCount / 400.0))} "
            >
              <span>
                字数统计: <span class="post-count word-count" th:text="${wordCount}">0</span>
                阅读时长: <span class="post-count reading-time" th:text="|${readingMinutes} min|">1 min</span>
              </span>
            </div>
            <!-- Post Meta: Date and Stats -->
            <div class="post-intro-meta">
              <span class="iconfont-archer post-intro-calander"></span>
              <span class="post-intro-time"
                    th:text="${#dates.format(post.spec.publishTime, 'yyyy/MM/dd')}">2024/01/01</span>
              <span id="busuanzi_container_page_pv" class="busuanzi-pv"
                    th:if="${theme.config.analytics?.busuanzi?.enable == true}">
                <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                <span id="busuanzi_value_page_pv"></span>
              </span>
              <!-- Share Buttons -->
              <span class="share-wrapper">
                <span class="iconfont-archer share-icon">&#xe71d;</span>
                <span class="share-text">Share</span>
                <ul class="share-list">
                  <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                    <div class="share-qrcode"></div>
                  </li>
                  <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                  <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                  <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                  <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                </ul>
              </span>
            </div>
          </div>
        </div>
      </div>

      <article class="article-entry" th:utext="${post.content.content}"></article>

      <!-- Previous/Next Post Navigation -->
      <th:block th:with="postCursor = ${postFinder.cursor(post.metadata.name)}">
        <ul
          class="post-paginator"
          th:if="${postCursor != null and (postCursor.hasPrevious() or postCursor.hasNext())}"
        >
          <li class="next">
            <div class="nextSlogan" th:if="${postCursor.hasPrevious()}">Next Post</div>
            <a th:href="@{${postCursor.previous.status.permalink}}" th:title="${postCursor.previous.spec.title}"
               th:if="${postCursor.hasPrevious()}">
              <div class="nextTitle" th:text="${postCursor.previous.spec.title}">Next Post Title</div>
            </a>
          </li>
          <li class="previous" th:if="${postCursor.hasNext()}">
            <div class="prevSlogan">Previous Post</div>
            <a th:href="@{${postCursor.next.status.permalink}}" th:title="${postCursor.next.spec.title}">
              <div class="prevTitle" th:text="${postCursor.next.spec.title}">Previous Post Title</div>
            </a>
          </li>
        </ul>
        <script th:inline="javascript" th:if="${postCursor != null}">
        </script>
      </th:block>

      <div class="license-wrapper" th:if="${theme.config.other.copyright?.enable == true}">
        <p>
          Author:
          <a
            th:href="${post.owner?.permalink != null ? post.owner.permalink : post.status.permalink}"
            th:text="${post.owner?.displayName != null ? post.owner.displayName : (theme.config.profile.author != null ? theme.config.profile.author : site.title)}"
          ></a>
        </p>
        <p>
          Permalink:
          <a th:href="${post.status.permalink}" th:text="${post.status.permalink}"></a>
        </p>
        <p th:if="${post.spec.publishTime != null}">
          Published:
          <span th:text="${#dates.format(post.spec.publishTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
        </p>
        <p th:if="${post.metadata.creationTimestamp != null}">
          Updated:
          <span th:text="${#dates.format(post.metadata.creationTimestamp, 'yyyy-MM-dd HH:mm:ss')}"></span>
        </p>
        <p th:if="${not #strings.isEmpty(theme.config.other.copyright?.license)}">
          License:
          <span th:utext="${theme.config.other.copyright.license}"></span>
        </p>
      </div>

      <div class="post-comment" th:if="${post.spec.allowComment}">
        <halo:comment group="content.halo.run" kind="Post" th:attr="name=${post.metadata.name}" />
      </div>

      <div th:if="${theme.config.other.math?.mathjax?.enable == true}">
        <script type="text/javascript" async
                th:src="${'https://cdn.jsdelivr.net/npm/mathjax@' + (theme.config.other.math?.mathjax?.version ?: '3.2.0') + '/es5/tex-mml-chtml.js'}">
        </script>
      </div>
    </main>
  </th:block>

  <th:block th:fragment="page_js">
    <script th:inline="javascript" th:if="${theme.config.other.outdated_threshold?.enable == true}">
      (function() {
        var time = document.getElementsByClassName('post-intro-time')[0]
        var article = document.getElementsByTagName('article')[0]
        if (!time || !article) {
          return
        }
        var pubTime = new Date(time.innerText)
        var now = Date.now()
        var interval = parseInt(now - pubTime)
        var days = parseInt(interval / 86400000)
        var threshold = parseInt(/*[[${theme.config.other.outdated_threshold.days}]]*/ 0)
        if (interval > threshold * 24 * 3600 * 1000) {
          article.innerHTML = '<div class="note note-warning">' +
            '<div class="title">文章时效性提示</div><p>这是一篇发布于 ' + days + ' 天前的文章，部分信息可能已发生改变，请注意甄别。</p>' +
            '</div>' + article.innerHTML
        }
      })()
    </script>
  </th:block>
</th:block>
